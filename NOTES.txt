Current issue: understand and eliminate spurious edge gradients.

Q1: Are there spurious edge gradients for...
  - fully populated images 
  - with displacement
  - single pass
  - spline interpolation of outliers
  - no smoothing

A1:
  1) [invalidated by #3 & #5, edge effects are reduced for un-equalized
  synthetic images] initial tests show NO edge effects for the synth test, but
  YES edge effects in image test.
  
  2) the difference is not size - the above remains true when the images size
  for synth is set the same as image, the edges are recongizably different, but
  not worse. 

  3) applying the equalization routine to the synthetic images makes the two
    results similar (both display bias at the edge)

  4) cropping off 40 pixels from all sides (> width of the equalization
    window) did not have any effect. The effect is not some "edge effect"
    in the equalization routine.

  5) to be sure, I disabled equalization for the synthetic images, and found that
    the edge effect is still there, just smaller

Q2: Is the problem related to data boundaries (e.g. the roi) or to the matrix
edges? 

A2:
  1) The problem is tied to the data boundaries, not the matrix edges. When I
  include a flat boundary within the matrix, the edge effect appears at that
  boundary, widens (from 1 pixel to 2 pixels), and worsens (from <0.5 pix to
  <0.9 pix). 

Q3: Is there any obvious difference in the correlation planes for edge- and
interior samples?

A3: Yes...

  1) Sample windows that contain a significant amount of (random) background are
  much noisier, and have poorly shaped (not gaussian, or even simple shaped)
  peaks.

  2) There is a significant bias in the x-direction at the lower boundary.

Q4: Does a "true" masked normalized cross correlation elimiate the bias?

A4:

  1) YES, for the synth test with no displacement and a horizontal boundary at y
  = 0.8. 

  2) YES, for the image test " "

  3) YES for both image and synth tests with horizontal boundary at y = 0.5, and
  with a sinusoidal boundary at witn mean = 0.7 and amplitude 0.2

Q5: It is necessary to cut off the correlation plane based on the number of
  overlapping pixels. Right now, I am using an arbitrary hard-coded value.  What
  is a reasonable choice for the overlap cutoff?

A5: The cutoff must be larger than the frac_data skip value, but less than a
  full window. I define two local parameters: a min_frac_data and a
  min_frac_overlap. For now, these are related by a simple multiple

Q6: Does the edge problem re-appear with non-zero (but constant) offsets?

A6: NO. The image test with uu = 10, vv = 10, and both yields similar(ly small)
errors to the zero offset case. The same is true for the synth case.

Q7: Does the edge problem re-appear with non-zero shear terms?

A7: 

  1) For image test with non-zero dudy, errors increase with increasing shear, but there is not
  concentrated high-error on the boundary. Switching back to the non-masked
  correlation yields noticable edge effect errors.

Q8: What is the effect of smoothing?

  0) Found a bug in the use of pppiv, in which I failed to supply an ROI (had
  previously uses NaNs, then stopped).

  1) For zero-displacement tests, it reduces noise, with no additional edge
  effects.

  2) For constant displacements in x, or y, or both, smoothing reduces noise
  without adding edge effects 

  3) For non-zero dudy shear, smoothing adds gradients at horizontal edges.
  Specifically, the bottom boundary, and horizontal or convex portions of the
  top boundary. Concave parts of the boundary are not obviously affected. 

  4) For non-zero dvdx shear, smoothing add gradients at vertical edges. I have
  no ability to test the importance of convexity.

Q9: Is the thin-plate-spline routine in MATLAB any better?

A9: For zero displacement, constant displacement and single non-zero shear
  terms, smoothing reduces noise without edge effects. For dual shear terms,
  everything goes to shit.

Q10: What is going wrong with the dual shear case?

A10:

  1) The errors are large (>1 pixel) for non-smoothed case as well.
  
  2) The errors return to normal levels (<0.05 pixels) only for small shear
  terms (i.e. 0.01)
 
  3) Relatively large single shear terms give errors on the order of 0.1 pixels

  4) The above suggest that either (a) my single pass routine is unable to
  adequately model this case, or, (b) my test case scripts are not computing the
  "true" solution correctly. Given other bugs in the test case (e.g. failure for
  negative displacements and shear terms), and also the performance for large
  single shear terms, the latter should be explored first.

Other observations:

  The wedge test case still has substatial edge gradients in the un-smoothed,
  normxcorr2_masked case. These disappear when a large mask erosion radius us
  used on the original images, which suggests that the gradient is real. 

  My plan is to refine the methods so that the test cases never show edge
  gradients, then the wedge results can be interpreted with confidence. An
  additional test using manual particle tracking may be useful if the edge
  gradient is large enough to rise above the error in manual point selection.

